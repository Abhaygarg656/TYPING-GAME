<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Z-Type Clone: Advanced Mission</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: #0a0a0c;
            color: #4dfed2;
            font-family: 'Press Start 2P', cursive; /* Retro font for a better feel */
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }

        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');

        #game-container {
            position: relative;
            box-shadow: 0 0 50px rgba(77, 254, 210, 0.2);
            border: 2px solid #1a1a1d;
            background: radial-gradient(circle, #1a1a2e 0%, #000 100%);
            overflow: hidden; /* To keep particles within bounds */
        }

        canvas {
            display: block;
        }

        #ui-overlay {
            position: absolute;
            top: 20px;
            left: 20px;
            pointer-events: none;
            font-size: 16px;
        }

        .stat {
            margin-bottom: 5px;
            text-shadow: 0 0 10px #4dfed2;
        }

        #health-bar-container {
            width: 150px;
            height: 15px;
            border: 1px solid #4dfed2;
            margin-top: 10px;
            position: relative;
        }

        #health-bar {
            height: 100%;
            width: 100%; /* Default to full health */
            background-color: #f00;
            transition: width 0.2s ease-out;
        }

        #menu, #game-over-screen {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            background: rgba(0, 0, 0, 0.9);
            padding: 40px;
            border: 1px solid #4dfed2;
            z-index: 100;
        }

        h1 {
            color: #4dfed2;
            font-size: 28px;
            margin-bottom: 20px;
        }

        p {
            font-size: 14px;
            margin-bottom: 30px;
        }

        button {
            background: transparent;
            border: 2px solid #4dfed2;
            color: #4dfed2;
            padding: 10px 25px;
            font-size: 16px;
            cursor: pointer;
            transition: 0.3s;
            margin: 10px;
            font-family: 'Press Start 2P', cursive;
        }

        button:hover {
            background: #4dfed2;
            color: #000;
        }
    </style>
</head>
<body>

<div id="game-container">
    <div id="ui-overlay">
        <div class="stat">SCORE: <span id="score">0</span></div>
        <div class="stat">WAVE: <span id="wave">1</span></div>
        <div class="stat">HEALTH:
            <div id="health-bar-container">
                <div id="health-bar"></div>
            </div>
        </div>
    </div>
    
    <div id="menu">
        <h1>Z-TYPE: ADVANCED MISSION</h1>
        <p>Type the words to defend your base!</p>
        <button onclick="startGame()">START MISSION</button>
    </div>

    <div id="game-over-screen" style="display:none;">
        <h1>MISSION FAILED!</h1>
        <p>Your final score: <span id="final-score">0</span></p>
        <button onclick="restartGame()">RETRY MISSION</button>
    </div>

    <canvas id="gameCanvas"></canvas>
</div>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const scoreEl = document.getElementById('score');
    const waveEl = document.getElementById('wave');
    const healthBar = document.getElementById('health-bar');
    const menu = document.getElementById('menu');
    const gameOverScreen = document.getElementById('game-over-screen');
    const finalScoreEl = document.getElementById('final-score');

    // Configuration
    canvas.width = 800;
    canvas.height = 600;
    
    let wordsList = [
        "ACTION", "SYSTEM", "GALAXY", "REACT", "LOGIC", "ENGINE", "FLIGHT", "DANGER", "VECTOR", "CRYPTO",
        "BINARY", "KERNEL", "VORTEX", "PHANTOM", "DEFEND", "SHIELD", "ASTEROID", "ORBIT", "PLASMA", "RELAY",
        "STATION", "GRAVITY", "WARP", "QUANTUM", "CYBER", "LASER", "PULSAR", "COMET", "SPACESHIP", "ALIEN"
    ];
    let enemies = [];
    let particles = [];
    let lasers = [];
    let score = 0;
    let wave = 1;
    let playerHealth = 100;
    let maxHealth = 100;
    let gameActive = false;
    let currentTarget = null;
    let lastSpawnTime = 0;
    let enemySpawnInterval = 3000; // Initial spawn interval

    // Sound Effects
    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
    function playSound(frequency, duration, type = 'sine', gain = 0.1) {
        const oscillator = audioContext.createOscillator();
        const gainNode = audioContext.createGain();

        oscillator.type = type;
        oscillator.frequency.setValueAtTime(frequency, audioContext.currentTime);
        gainNode.gain.setValueAtTime(gain, audioContext.currentTime);

        oscillator.connect(gainNode);
        gainNode.connect(audioContext.destination);

        oscillator.start();
        oscillator.stop(audioContext.currentTime + duration);
    }
    
    const explosionSound = () => playSound(100, 0.2, 'sawtooth', 0.5);
    const hitSound = () => playSound(440, 0.05, 'square', 0.2);
    const missSound = () => playSound(50, 0.5, 'triangle', 0.3); // For game over

    class Enemy {
        constructor(word, speed) {
            this.word = word;
            this.remaining = word;
            this.x = Math.random() * (canvas.width - ctx.measureText(word).width - 100) + 50;
            this.y = -50;
            this.speed = speed;
            this.fontSize = 20;
            this.color = '#4dfed2';
            this.isTarget = false;
        }

        update() {
            this.y += this.speed;
            if (this.y > canvas.height - 30) {
                playerHealth -= 20; // Lose health if enemy passes
                updateHealthBar();
                missSound();
                createExplosion(this.x + this.word.length * 5, canvas.height - 20, '#ff0000'); // Red explosion on base hit
                return true; // Indicate enemy passed
            }
            return false;
        }

        draw() {
            ctx.font = `bold ${this.fontSize}px 'Press Start 2P'`;
            ctx.textBaseline = 'middle';

            // Draw full word (ghost/untyped)
            ctx.fillStyle = this.color + '88'; // Lighter, semi-transparent
            ctx.shadowBlur = 0;
            ctx.fillText(this.word, this.x, this.y);
            
            // Draw typed part (highlight)
            if (this.word.length - this.remaining.length > 0) {
                ctx.fillStyle = '#fff';
                ctx.shadowBlur = 15;
                ctx.shadowColor = '#4dfed2';
                const typedPart = this.word.substring(0, this.word.length - this.remaining.length);
                ctx.fillText(typedPart, this.x, this.y);
                ctx.shadowBlur = 0;
            }
        }
    }

    class Particle {
        constructor(x, y, color) {
            this.x = x;
            this.y = y;
            this.vx = (Math.random() - 0.5) * 8;
            this.vy = (Math.random() - 0.5) * 8;
            this.alpha = 1;
            this.color = color;
            this.size = Math.random() * 3 + 1;
        }
        update() {
            this.x += this.vx;
            this.y += this.vy;
            this.alpha -= 0.03;
        }
        draw() {
            ctx.fillStyle = `rgba(${parseInt(this.color.slice(1,3), 16)}, ${parseInt(this.color.slice(3,5), 16)}, ${parseInt(this.color.slice(5,7), 16)}, ${this.alpha})`;
            ctx.fillRect(this.x, this.y, this.size, this.size);
        }
    }

    class Laser {
        constructor(startX, startY, endX, endY, color) {
            this.startX = startX;
            this.startY = startY;
            this.endX = endX;
            this.endY = endY;
            this.color = color;
            this.alpha = 1;
            this.width = 3;
            this.duration = 10; // Frames
            this.currentFrame = 0;
        }

        update() {
            this.currentFrame++;
            this.alpha = 1 - (this.currentFrame / this.duration);
            if (this.currentFrame >= this.duration) {
                return true; // Mark for removal
            }
            return false;
        }

        draw() {
            ctx.beginPath();
            ctx.moveTo(this.startX, this.startY);
            ctx.lineTo(this.endX, this.endY);
            ctx.strokeStyle = `rgba(${parseInt(this.color.slice(1,3), 16)}, ${parseInt(this.color.slice(3,5), 16)}, ${parseInt(this.color.slice(5,7), 16)}, ${this.alpha})`;
            ctx.lineWidth = this.width;
            ctx.shadowBlur = 10;
            ctx.shadowColor = this.color;
            ctx.stroke();
            ctx.shadowBlur = 0;
        }
    }

    function spawnEnemy() {
        if (!gameActive) return;
        const word = wordsList[Math.floor(Math.random() * wordsList.length)];
        enemies.push(new Enemy(word, 0.3 + (wave * 0.05)));
        
        enemySpawnInterval = Math.max(500, 3000 - (wave * 100)); // Min 500ms
        if (gameActive) setTimeout(spawnEnemy, enemySpawnInterval);
    }

    function createExplosion(x, y, color = '#4dfed2') {
        for (let i = 0; i < 20; i++) {
            particles.push(new Particle(x, y, color));
        }
    }

    function drawPlayerShip() {
        const shipWidth = 60;
        const shipHeight = 30;
        const shipX = canvas.width / 2;
        const shipY = canvas.height - 40;

        ctx.fillStyle = '#fff';
        ctx.strokeStyle = '#4dfed2';
        ctx.lineWidth = 2;
        ctx.shadowBlur = 10;
        ctx.shadowColor = '#4dfed2';

        // Main body
        ctx.beginPath();
        ctx.moveTo(shipX, shipY - shipHeight / 2);
        ctx.lineTo(shipX + shipWidth / 2, shipY + shipHeight / 2);
        ctx.lineTo(shipX - shipWidth / 2, shipY + shipHeight / 2);
        ctx.closePath();
        ctx.fill();
        ctx.stroke();
        
        // Cockpit
        ctx.beginPath();
        ctx.arc(shipX, shipY, 8, 0, Math.PI * 2);
        ctx.fillStyle = '#00f';
        ctx.fill();
        ctx.strokeStyle = '#fff';
        ctx.stroke();

        ctx.shadowBlur = 0;
    }

    function updateHealthBar() {
        healthBar.style.width = `${(playerHealth / maxHealth) * 100}%`;
        if (playerHealth <= 0) {
            gameOver();
        }
    }

    let animationFrameId;

    function update() {
        if (!gameActive) return;

        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // Draw Player Ship
        drawPlayerShip();

        // Update Enemies
        enemies = enemies.filter(enemy => {
            const passed = enemy.update();
            if (passed) {
                if (currentTarget === enemy) currentTarget = null; // Untarget if enemy passes
                return false; // Remove enemy
            }
            enemy.draw();
            return true;
        });
        
        // Update Particles
        particles = particles.filter(p => {
            p.update();
            p.draw();
            return p.alpha > 0;
        });

        // Update Lasers
        lasers = lasers.filter(laser => {
            const finished = laser.update();
            if (!finished) {
                laser.draw();
            }
            return !finished;
        });

        animationFrameId = requestAnimationFrame(update);
    }

    window.addEventListener('keydown', (e) => {
        if (!gameActive) return;
        const char = e.key.toUpperCase();

        if (currentTarget) {
            if (currentTarget.remaining.startsWith(char)) {
                hitSound();
                currentTarget.remaining = currentTarget.remaining.substring(1);
                lasers.push(new Laser(
                    canvas.width / 2, canvas.height - 40, 
                    currentTarget.x + (currentTarget.word.length - currentTarget.remaining.length) * (currentTarget.fontSize * 0.6), 
                    currentTarget.y, 
                    '#ff00ff' // Purple laser for typed letters
                ));
                createExplosion(
                    currentTarget.x + (currentTarget.word.length - currentTarget.remaining.length) * (currentTarget.fontSize * 0.6), 
                    currentTarget.y, 
                    '#ff00ff'
                );
                
                if (currentTarget.remaining.length === 0) {
                    explosionSound();
                    score += 100 + (wave * 10); // More points for higher waves
                    scoreEl.innerText = score;
                    createExplosion(currentTarget.x + currentTarget.word.length * 5, currentTarget.y);
                    enemies = enemies.filter(en => en !== currentTarget);
                    currentTarget.isTarget = false;
                    currentTarget = null;
                    
                    if (score % (500 + wave * 100) === 0) { // Wave up logic
                        wave++;
                        waveEl.innerText = wave;
                    }
                }
            } else {
                // Wrong key for current target - maybe a small penalty or just ignore
            }
        } else {
            // No current target, try to find one
            for (let i = 0; i < enemies.length; i++) {
                if (enemies[i].remaining.startsWith(char)) {
                    currentTarget = enemies[i];
                    currentTarget.isTarget = true;
                    hitSound();
                    currentTarget.remaining = currentTarget.remaining.substring(1);
                    lasers.push(new Laser(
                        canvas.width / 2, canvas.height - 40, 
                        currentTarget.x + (currentTarget.word.length - currentTarget.remaining.length) * (currentTarget.fontSize * 0.6), 
                        currentTarget.y, 
                        '#ff00ff'
                    ));
                    createExplosion(
                        currentTarget.x + (currentTarget.word.length - currentTarget.remaining.length) * (currentTarget.fontSize * 0.6), 
                        currentTarget.y, 
                        '#ff00ff'
                    );
                    break; 
                }
            }
        }
    });

    function startGame() {
        gameActive = true;
        score = 0;
        wave = 1;
        playerHealth = maxHealth;
        enemies = [];
        particles = [];
        lasers = [];
        currentTarget = null;
        scoreEl.innerText = "0";
        waveEl.innerText = "1";
        menu.style.display = "none";
        gameOverScreen.style.display = "none";
        updateHealthBar();
        spawnEnemy();
        animationFrameId = requestAnimationFrame(update);
    }

    function gameOver() {
        gameActive = false;
        cancelAnimationFrame(animationFrameId); // Stop game loop
        finalScoreEl.innerText = score;
        gameOverScreen.style.display = "block";
        missSound(); // Play a game over sound
    }

    function restartGame() {
        gameOverScreen.style.display = "none";
        menu.style.display = "block"; // Show main menu again
        // Game state reset happens in startGame()
    }

    // Initialize game on load
    window.onload = () => {
        menu.style.display = "block";
        updateHealthBar(); // Set initial health bar
        // Pre-render the first frame to show player ship
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        drawPlayerShip();
    };

</script>
</body>
</html>